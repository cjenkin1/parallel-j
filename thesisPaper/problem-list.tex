\chapter{Example Parallel Problems}
\label{probs}

\section{Rationale}
Each of the following problems was selected to illustrate 
both the advantages in approaching different forms of exploitable concurrency with the notion of function rank, 
as well as to illustrate how extensions of these problems to higher dimensions can be done easily, safely, 
and in an automatically data parallel fashion.

To demonstrate this, the problems were chosen so as to illustrate different kinds of \textit{parallel design patterns}. 
\textit{Design Patterns} are general, reusable solutions to a common class of problems. % TODO cite? (from Wikipedia)
Software design patterns were first made popular for object-oriented programming through the work of the "Gang of Four," % TODO cite
and are now seeing interest for applications in parallel computing. % TODO cite Massingill, Berkely work 
This research has chosen to focus on the pattern language developed by Mattson et. al. 
presented in their book, "Patterns for Parallel Programming." % TODO justify?
Using parallel design patterns to guide the choices and discussion of these problems 
should allow this limited selection of problems to better represent families of parallel problems.

\section{Calculating Pi with Numerical Integration}
\subsection{Description}
One method of calculating $\pi$ is find the area of the unit circle. 
To do this, one can choose to calculate the area top right quandrant of the unit circle in the Cartesian plane, 
then multiply this area by 4. 
This is done with the following equation:

\[\pi = 4 \cdot \int_0^1 \frac{1}{1 + x^2} \; dx\]

One way to approximate this formula is to use a right-handed Riemann sum:

\[\frac{4}{n} \\cdot \sum_{i=0}^n \sqrt{1 - x^2} \]

where $x = \frac{i}{n}$

\subsection{Relevant Design Pattern}
This problem was chosen to represent the \textit{Task Parallelism} pattern, 
in which ``the problem is decomposed into a collection of tasks that can execute concurrently.'' % TODO \cite{ppp}
In this problem, the concurrent tasks are calculating $\sqrt{1 - x^2}$ for the different values of $x$. 
There is also a task dependency: the multiplication of $\frac{4}{n}$ and the sum of the values produced by each task 
cannot occur until all tasks have finished. 
Each individual task takes roughly the same amount of time, as well, 
meaning no sophisticated scheduling is required in order to exploit concurrency effectively for large $n$.

\subsection{Solutions}
\subsubsection{C with OpenMP}
A parallel solution to this problem using C with the OpenMP libraries is given below. 
It is based off of the solution given in Appendix A of Mattson et. al. % TODO \cite{ppp}

\verbatiminput{num-int-par.c}

This solution parallelizes each of the iterations of the for loop 
and specifies both that $x$ is a temporary work variable and so should not be shared among threads, 
and that there is to be a reduction on the variable $sum$ with addition. 
Since the entire body of the for loop is parallelized, including the update of $sum$, 
the annotations notifying the compiler of the reduction and private work variable is critical; 
otherwise, there could very well be race conditions.

\subsubsection{J}
A sequential J solution to this problem is given below, 
with some definitions to facilitate a discussion 
of the behavior of a solution in the proposed Parallel-J. % TODO parallel insert

\verbatiminput{num_int_pi.ijs}

This solution works conceptually by taking the for loop from the previous C solution 
and expanding it into an array, generated by $xs$.
Operations which were done in the body of the C for loop 
are instead expressed as operations on the whole array. 
Because J is functional, and 
because it allows the programer to express collective rather than item-by-item operations, 
the need for the temporary work variable $x$ used in the previous solution is obviated. 
Thus, a possible source of error is eliminated.

Similiarly, whereas the C solution required 
protecting against race conditions when reducing on the $sum$ variable
by giving compiler annotations, 
in the J solution this was never a risk.
Either the $sum$ operation would be safely parallel with $/::$ or 
it would be sequential with $/$.

\section{Game of Life}
